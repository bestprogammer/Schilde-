<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Todesstern Schilde mit Tastatur</title>
<style>
  body {
    margin: 0;
    background-color: #000;
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    user-select: none;
  }
  #codeInputContainer {
    width: 300px;
    margin: 15px 0 5px;
  }
  #codeInput {
    width: 100%;
    padding: 8px 10px;
    font-size: 1.8rem;
    font-weight: 900;
    text-align: center;
    border: none;
    border-radius: 6px;
    outline: none;
    letter-spacing: 0.3em;
    background: white;
    color: black;
    font-family: monospace;
  }
  .container {
    position: relative;
    width: 300px;
    height: 300px;
    outline: none;
    cursor: default;
    user-select: none;
  }
  .death-star {
    width: 100%;
    height: 100%;
    background: url('https://upload.wikimedia.org/wikipedia/en/f/f9/Death_star1.png') no-repeat center center;
    background-size: contain;
    border-radius: 50%;
    position: relative;
    z-index: 10;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
  }
  .shield-ring {
    position: absolute;
    border: 2px solid rgba(0, 255, 255, 0.7);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.7);
    opacity: 0.8;
    pointer-events: none;
    animation-name: pulse;
    animation-iteration-count: infinite;
    animation-timing-function: ease-out;
  }
  .ring1 { width: 320px; height: 320px; animation-delay: 0s; }
  .ring2 { width: 360px; height: 360px; animation-delay: 1s; }
  .ring3 { width: 400px; height: 400px; animation-delay: 2s; }
  @keyframes pulse {
    0% { opacity: 0.8; transform: translate(-50%, -50%) scale(0.7); }
    70% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
  }
  @keyframes blink-red {
    0%, 100% { border-color: rgba(255, 0, 0, 0.9); opacity: 0.9; }
    50% { border-color: rgba(255, 0, 0, 0.1); opacity: 0.1; }
  }
  .warning {
    position: absolute;
    top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 2rem; font-weight: bold; color: red;
    text-shadow: 0 0 10px red; z-index: 30; display: none;
  }
  .label {
    position: absolute;
    top: 10px; left: 50%; transform: translateX(-50%);
    font-size: 1.5rem; font-weight: bold;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.9);
    z-index: 20;
    transition: color 0.3s ease;
  }
  .input-feedback {
    position: absolute;
    bottom: 10px; left: 50%; transform: translateX(-50%);
    color: #0ff; font-size: 1rem;
    font-family: monospace; z-index: 25;
  }
  .fire-animation {
    display: none;
    position: absolute;
    top: 50%; left: 50%;
    width: 250px; height: 250px;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 50;
    background: radial-gradient(circle, #ffae00 0%, #ff3300 50%, rgba(0,0,0,0.1) 100%);
    opacity: 0.8;
    animation: explode 1s linear forwards;
  }
  @keyframes explode {
    0%   { opacity: 0.8; transform: translate(-50%, -50%) scale(1);}
    60%  { opacity: 1;   transform: translate(-50%, -50%) scale(1.5);}
    100% { opacity: 0;   transform: translate(-50%, -50%) scale(2);}
  }
  .blocked-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.6rem;
    font-weight: bold;
    color: red;
    user-select: none;
    text-align: center;
    padding: 15px;
  }
</style>
</head>
<body>
  <div id="codeInputContainer">
    <input id="codeInput" maxlength="4" autocomplete="off" spellcheck="false" placeholder="Code eingeben" autofocus />
  </div>

  <div class="container" tabindex="0" aria-label="Todesstern Schildsteuerung">
    <div class="label" id="shieldLabel">Schilde: --</div>
    <div class="warning" id="warningText">⚠️ Achtung! Schilde kritisch! ⚠️</div>
    <div class="shield-ring ring1"></div>
    <div class="shield-ring ring2"></div>
    <div class="shield-ring ring3"></div>
    <div class="death-star"></div>
    <div class="fire-animation" id="fireAnimation"></div>
    <div class="input-feedback" id="inputFeedback"></div>
  </div>

  <video id="video" autoplay muted playsinline style="display:none;"></video>

  <div class="blocked-overlay" id="blockedOverlay" style="display:none;">
    SYSTEM GESPERRT<br>Bitte Code erneut eingeben, um zu entsperren.
  </div>

<script>(() => {
  const codeInput = document.getElementById('codeInput');
  const blockedOverlay = document.getElementById('blockedOverlay');
  const container = document.querySelector('.container');
  const shieldLabel = document.getElementById('shieldLabel');
  const warningText = document.getElementById('warningText');
  const rings = document.querySelectorAll('.shield-ring');
  const fireAnimation = document.getElementById('fireAnimation');
  const inputFeedback = document.getElementById('inputFeedback');
  const video = document.getElementById('video');

  const SECRET_CODE = "2014";

  let shieldValue = 100;
  let unlocked = false;
  let blockMode = true; // Direkt bei Start gesperrt
  let zeroPressTimes = [];

  function focusInput() {
    codeInput.focus();
    setTimeout(() => codeInput.focus(), 100); // Sicherstellen, dass es fokussiert bleibt
  }

  // Kamera starten
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({video: true});
      video.srcObject = stream;
    } catch(e) {
      console.warn('Kamera nicht verfügbar.');
    }
  }
  startCamera();

  function takeSnapshot() {
    if (!video.srcObject) return;
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 640;
    canvas.height = video.videoHeight || 480;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `snapshot_${new Date().toISOString().replace(/[:.]/g,'-')}.png`;
      a.click();
      URL.revokeObjectURL(url);
    }, 'image/png');
  }

  function updateStatus() {
    shieldLabel.textContent = `Schilde: ${shieldValue}%`;

    if (shieldValue <= 10) {
      rings.forEach(r => {
        r.style.borderColor = 'rgba(255, 0, 0, 0.9)';
        r.style.animationName = 'blink-red';
      });
      warningText.style.display = 'block';
    } else {
      rings.forEach(r => {
        r.style.borderColor = 'rgba(0, 255, 255, 0.7)';
        r.style.animationName = 'pulse';
      });
      warningText.style.display = 'none';
    }

    if (shieldValue <= 0) {
      fireAnimation.style.display = 'block';
      setTimeout(() => {
        fireAnimation.style.display = 'none';
      }, 1200);
      activateBlock();
    }
  }

  function activateBlock() {
    blockMode = true;
    unlocked = false;
    shieldValue = 0;
    updateStatus();
    blockedOverlay.style.display = 'flex';
    inputFeedback.textContent = '';
    codeInput.value = '';
    codeInput.style.display = 'block';
    focusInput();
  }

  function deactivateBlock() {
    blockMode = false;
    unlocked = true;
    shieldValue = 100;
    updateStatus();
    blockedOverlay.style.display = 'none';
    inputFeedback.textContent = 'System entsperrt';
    takeSnapshot();
    setTimeout(() => inputFeedback.textContent = '', 2500);
    codeInput.value = '';
    focusInput();
  }

  function checkCode(val) {
    if (val === SECRET_CODE) {
      if (blockMode) deactivateBlock();
      else if (!unlocked) {
        unlocked = true;
        shieldValue = 100;
        updateStatus();
        blockedOverlay.style.display = 'none';
      }
      takeSnapshot();
      inputFeedback.textContent = 'Code korrekt!';
      setTimeout(() => inputFeedback.textContent = '', 2000);
      codeInput.value = '';
    }
  }

  function checkZeroSequence(key) {
    if (key === "0") {
      const now = Date.now();
      zeroPressTimes.push(now);
      if (zeroPressTimes.length > 4) zeroPressTimes.shift();
      if (zeroPressTimes.length === 4 && zeroPressTimes[3] - zeroPressTimes[0] <= 1000) {
        activateBlock();
        zeroPressTimes = [];
      }
    } else {
      zeroPressTimes = [];
    }
  }

  codeInput.addEventListener('input', e => {
    const val = codeInput.value;

    if (blockMode) {
      checkCode(val);
    } else {
      checkZeroSequence(val.slice(-1));
      if (val.includes("0000")) {
        activateBlock();
        return;
      }

      checkCode(val);

      if (unlocked && /^\d{1,3}$/.test(val)) {
        if (val === "00") {
          shieldValue = 100;
        } else {
          let num = parseInt(val, 10);
          if (num >= 0 && num <= 100) shieldValue = num;
        }
        updateStatus();
      }
    }
    focusInput();
  });

  // Initialisierung
  updateStatus();
  codeInput.style.display = 'block';
  blockedOverlay.style.display = 'flex';
  focusInput();
})();
</script>
</body>
</html>
<!DOCTYPE html>
<!-- [CODE REDACTED FOR LENGTH: Contains full HTML with lock mechanism, camera photo on unlock, shield control, etc.] -->
